{{extend 'layout.html'}}
{{block head}}
<script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="//d79i1fxsrar4t.cloudfront.net/jquery.liveaddress/5.1/jquery.liveaddress.min.js"></script>
<script src="{{=URL('static', 'js/vue.js')}}"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">


<script>
      var add_address_url = "{{=URL('api', 'insert_new_address', user_signature=False)}}";
      var get_property_types_url = "{{=URL('api', 'get_property_types', user_signature=False)}}";
      var add_property_url = "{{=URL('api', 'add_property', user_signature=True)}}";
      var get_owned_properties_url = "{{=URL('api', 'get_owned_properties', user_signature=True)}}";
      var get_liked_properties_url = "{{=URL('default', 'get_liked_properties')}}";
      var get_my_liked_properties_url ="{{=URL('default', 'get_my_liked_properties')}}";
</script>

<script>
    var users_url = "{{=URL('groups', 'get_users', user_signature=True)}}";
    var search_users_url = "{{=URL('groups', 'search_users', user_signature=True)}}";
    var groups_url = "{{=URL('groups', 'get_groups', user_signature=True)}}";
    var members_url = "{{=URL('groups', 'get_members', user_signature=True)}}";
    var add_group_url = "{{=URL('groups', 'add_group', user_signature=True)}}";
    var toggle_is_editing = "{{=URL('groups', 'is_editing', user_signature=True)}}";
    var add_member_url = "{{=URL('groups', 'add_member', user_signature=True)}}";
    var del_member_url = "{{=URL('groups', 'del_member', user_signature=True)}}";
    var delete_group_url = "{{=URL('groups', 'delete_group', user_signature=True)}}";
    var get_insertion_url = "{{=URL('groups', 'get_insertion_id', user_signature=True)}}";
    var clean_members_url = "{{=URL('groups', 'clean_members', user_signature=True)}}"
</script>

{{end}}


<!-- Edit the HTML for profile page here -->

<div id="profile">

<div id="vue-div" class="main_content">
    <div class="container compressible">

        <div class="left_side container quarter max900">
            <div class="user_info padded ">
            {{if auth.user is not None:}}
                <!--This the statically served default profile picture -->
                {{=A(IMG(_src=URL('static/images', 'default_user.jpg'), _alt="default user image"))}}
            {{else:}}
                <!--This should be the users uploaded profile picture.... if it ever works -->
                {{=A(IMG(_src=URL('default', 'download', args=pic), _alt=" user image"))}}
            {{pass}}

                <div class="user_text">
                    <h3>{{=auth.user.first_name}} {{=auth.user.last_name}}</h3>
                    <h6>My Rentals</h6>
                    <h6>My Listings</h6>
                    <h6>Liked Properties</h6>

					<div class="add_property">

            		</div>
				</div>

            </div>
            <div class="button_list container">
                <div class="add_btn half">
                     <button v-if="!is_adding_property" class="rounded" v-on:click="add_property_button()" >
                        <i class="fa fa-plus"></i>
                        Add Property
                     </button>
                     <button v-if="is_adding_property" class="rounded" v-on:click="add_property_button()" >
                        <i class="fa fa-close"></i>
                        Close
                    </button>
                </div>
                <div class="half group_btn">
                    <button v-if="!is_adding_group" class="rounded " v-on:click="add_group_button()">
                            <i class="fa fa-plus"></i> Create Group
                    </button>
                </div>
            </div>


        </div>

        <div class="right_side container threequarters max900 compressible">
            <div class="add_property_div padded container" id="add_property_div" style="display:none">
                <h4>Add a new property </h4>
                <div v-if="add_property_page == 0">
                    <h5>What is the address?</h5>
                    <form>
                        Street: <input type="text" name="street" v-model="form_street" placeholder="Street..."><br>
                        City: <input type="text" name="city" v-model="form_city" placeholder="City..."><br>
                        Zip Code: <input type="text" name="zip" v-model="form_zip" placeholder="Zip code..."><br>
                        State: <input type="text" name="state" v-model="form_state_" placeholder="City..."><br>
                    </form>

                </div>
                <div v-if="add_property_page == 1">
                    <h5>Tell us about the property</h5>
                    <form>
                        <label>Property Type </label><br>
                            <select class="drop_down_field"  name="p_type" v-model="p_type">
                                <!--For this one, I need to get the .id of the selected value
                                    But I think I can just grab it before the post request
                                 -->
                                <option v-for="p in property_types">${p.p_type}</option>
                            </select>
                        <label>Number of Bedrooms </label><br>
                        <select class="drop_down_field" name="num_bedrooms" v-model="num_bedrooms" >
                            <option v-for="n in 10" >${n}</option>
                        </select>
                        <div class="container">

                           <div class="half">
                                <label>Full Bathrooms </label><br>
                                    <select class="drop_down_field" name="num_fullbaths" v-model="num_fullbaths">
                                        <option v-for="n in 10" >${n}</option>
                                    </select>
                            </div>
                            <div class="half">
                                <label>Half Bathrooms </label><br>
                                    <select class="drop_down_field" name="num_halfbaths" v-model="num_halfbaths">
                                        <option v-for="n in 10">${n}</option>
                                    </select>
                            </div>
                        </div>

                    </form>
                </div>
                <div class="button_bar padded">
                    <span v-if="add_property_page == last_add_property_page">
                        <button v-on:click="prev_page">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <button v-on:click="add_property">
                            <i class="far fa-share-square"></i>
                            Submit
                        </button>
                    </span>

                    <span v-if="add_property_page == 0">
                        <button v-on:click="next_page">
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </span>

                </div>

            </div>

            <div class="property_info ">
                <div class="right_side_banner">
                    <h4>My Properties</h4>
                </div>

                <div class="owned_properties container padded" v-for="p in owned_properties">
                    <div class="padded half">
                        <h6>Street:</h6><p>${p.street}</p>
                        <h6>City:</h6> <p>${p.city}</p>
                        <h6>Zip Code:</h6> <p>${p.zip}</p>
                        <h6>Sate:</h6><p>${p.state_}</p>
                    </div>
                    <div class="padded half">
                        <h6>Property Type</h6><p>${p.property_type}</p>
                        <h6>Number of Bedrooms</h6> <p>${p.num_bedrooms}</p>
                        <h6>Number of full bathrooms</h6><p>${p.num_fullbaths}</p>
                        <h6>Number of half bathrooms</h6> <p>${p.num_halfbaths}</p>
                    </div>
                </div>

            </div>

			<div class="liked_properties">
				<div class="right_side_banner">
                    <h4>Liked Properties <i class="fa fa-thumbs-up"></i></h4>
                </div>
				<div class="liked_prop container padded" v-for="property in liked_properties">
					<div class="padded half">
                        <h6>Street:</h6><p>${property.street}</p>
                        <h6>City:</h6> <p>${property.city}</p>
                        <h6>Zip Code:</h6> <p>${property.zip}</p>
                        <h6>Sate:</h6><p>${property.state_}</p>
                    </div>
                    <div class="padded half">
                        <h6>Property Type</h6><p>${property.property_type}</p>
                        <h6>Number of Bedrooms</h6> <p>${property.num_bedrooms}</p>
                        <h6>Number of full bathrooms</h6><p>${property.num_fullbaths}</p>
                        <h6>Number of half bathrooms</h6> <p>${property.num_halfbaths}</p>
                    </div>
				</div>


			</div>


            <div class="group_info">
                <div class="right_side_banner">
                    <h4>Groups</h4>
                </div>
                <!--<div class="my_groups"> -->
                    <div class="one_group container" v-for="group in groups">
                        <div class="container padded">
                            <div class="quarter">
                                <h6 class="">${group.group_name}</h6>
                            </div>
                            <div class="button_bar threequarters padded right">
                                <button class="btn rounded">
                                        <i class="fa fa-plus"></i>
                                </button>
                                <button v-if="!group.is_editing" class="btn rounded" v-on:click="edit_group_button(group.group_id)">
                                    <i class="fa fa-edit"></i>
                                </button>
                                <span v-if="group.is_editing" class="button_list right">

                                    <button class="btn rounded delete" v-on:click="delete_group(group.group_id)">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                    <button class="btn rounded" v-on:click="cancel_edit_group(group.group_id)">
                                        <i class="fa fa-times"></i>
                                    </button>
                                </span>



                            </div>

                        </div>
                        <div class="padded" id="member_list">
                            <table class="members">
                                <thead>
                                    <th>Members</th>
                                </thead>
                                <tbody >
                                    <tr v-for="mem in group.group_members">
                                        <td>${mem.user_email}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                <!--</div> -->

                <div v-if="is_adding_group" class="group_search padded">
                    <span class="padded right">
                        <button v-if="is_adding_group" class="btn padded rounded" v-on:click="submit_group_button()" >
                            <i class="fa fa-plus"></i> Submit
                        </button>
                        <button v-if="is_adding_group" class="btn padded rounded" v-on:click="cancel_add_group()">
                            <i class="fa fa-times"></i> Cancel
                        </button>
                    </span>
                    <h5 class="title"> New Group </h5>
                    <div v-if="is_adding_group" class="members">
                        <form class="padded">
                            <input class="string" v-model="form_name" placeholder="Enter your Group Name" type="text">
                        </form>
                        <div class="padded">
                            <table class="member_table padded">
                                <thead>
                                    <th>Members</th>
                                    <th></th>
                                    <th></th>
                                </thead>
                                <tbody>
                                    <tr v-for="mem in members">
                                        <td>
                                        {{=A(IMG(_src=URL('static/images', 'default_user.jpg'), _alt="default user image"))}}
                                        </td>
                                        <td>${mem.first_name} ${mem.last_name}</td>
                                        <td><i class="fa fa-trash btn" v-on:click="remove_from_group(mem, mem._idx)"></i></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <h5 class="title">Add Groupmates</h5>
                    <div class="padded">
                        <form class="padded">
                            <input class="string" v-model="form_user_search" placeholder="Search" type="text">
                        </form>
                        <span class="padded">
                            <button class="btn padded rounded" v-on:click="search_user()">
                                <i class="fa fa-search"></i>
                            </button>
                            <button class="btn padded rounded" v-on:click="clear_user_button()">
                                <i class="fa fa-times"></i>
                            </button>
                        </span>
                        <table class="user_table">
                            <thead>
                                <tr>
                                    <th>Photo</th>
                                    <th>User</th>
                                    <th>add ?</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="usr in users">
                                    <td>${usr.picture}</td>
                                    <td>${usr.first_name} ${usr.last_name}</td>
                                    <td><i class="fa fa-plus btn" v-on:click="add_to_group(usr, usr._idx)"></i></td>
                                </tr>
                            </tbody>
                        </table>
                        <div v-if="has_more" class="show_more">
                            <button class="btn btn-default rounded" v-on:click="get_more()">
                                <i class="fa fa-ellipsis-h"></i> Load more
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    </div>
    </div>
</div>

<script src="{{=URL('static', 'js/default_profile.js')}}"></script>